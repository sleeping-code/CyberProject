<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Threat Identification</title>
  <link rel="stylesheet" href="UI.CSS">
</head>
<body>
  <div class="container">
    <!-- Sidebar remains unchanged -->
    <aside class="sidebar">
      <!-- ... existing sidebar content ... -->
    </aside>

    <main class="content">
      <header class="header">
        <h1>Threat Identification</h1>
      </header>
      <form id="step2-form" action="step3.html" method="POST" onsubmit="return validateForm()">
        <!-- Existing fields -->
        <label for="system-name" class="block mb-2">System Name:</label>
        <input type="text" id="system-name" name="system-name" required class="w-full p-2 mb-5 border rounded" />

        <!-- Threat Identification Fields -->
        <div class="mb-8">
          <h2 class="text-xl font-semibold mb-4">Threat Sources</h2>
          
          <!-- Threat Categories -->
          <fieldset class="mb-6">
            <legend class="block mb-2 font-medium">Threat Categories:</legend>
            <div class="grid grid-cols-3 gap-4">
              <div class="border p-3 rounded">
                <h3 class="font-medium mb-2">Internal Threats</h3>
                <label class="block"><input type="checkbox"> Disgruntled employees</label>
                <label class="block"><input type="checkbox"> Contractors</label>
                <label class="block"><input type="checkbox"> Accidental misuse</label>
              </div>
              <div class="border p-3 rounded">
                <h3 class="font-medium mb-2">External Threats</h3>
                <label class="block"><input type="checkbox"> Hackers</label>
                <label class="block"><input type="checkbox"> Nation-states</label>
                <label class="block"><input type="checkbox"> Competitors</label>
              </div>
              <div class="border p-3 rounded">
                <h3 class="font-medium mb-2">Environmental Threats</h3>
                <label class="block"><input type="checkbox"> Natural disasters</label>
                <label class="block"><input type="checkbox"> Power outages</label>
              </div>
            </div>
          </fieldset>

          <!-- Threat Motivation -->
          <div class="mb-6">
            <label class="block mb-2 font-medium">Threat Motivation:</label>
            <select class="w-full p-2 border rounded">
              <option value="">Select Motivation</option>
              <option>Financial gain</option>
              <option>Espionage</option>
              <option>Hacktivism</option>
              <option>Accidental</option>
              <option>Sabotage</option>
            </select>
          </div>

          <!-- Threat Capacity -->
          <div class="mb-6">
            <label class="block mb-2 font-medium">Threat Capacity (1-5):</label>
            <div class="flex items-center">
              <input type="range" id="capacity" min="1" max="5" value="3" 
                     class="flex-1" oninput="updateCapacityValue(this.value)">
              <span id="capacityValue" class="ml-3">3</span>
            </div>
          </div>
        </div>

        <!-- MISP Integration -->
        <div class="mb-8">
          <h2 class="text-xl font-semibold mb-4">MISP Threat Intelligence</h2>
          
          <div class="mb-4 flex gap-4">
            <select id="severityFilter" class="p-2 border rounded" onchange="filterMISPThreats()">
              <option value="">All Severities</option>
              <option>Critical</option>
              <option>High</option>
              <option>Medium</option>
              <option>Low</option>
            </select>
            
            <input type="text" id="relevanceFilter" placeholder="Filter by relevance..." 
                   class="p-2 border rounded flex-1" oninput="filterMISPThreats()">
          </div>

          <div id="mispThreats" class="border rounded p-3">
            <!-- Threat items will be populated here -->
          </div>
        </div>

        <!-- Navigation buttons -->
        <div class="flex justify-between">
          <button type="button" class="bg-indigo-600 text-white py-2 px-4 rounded" onclick="goToPreviousPage()">Previous</button>
          <button type="submit" class="bg-indigo-600 text-white py-2 px-4 rounded">Next</button>
        </div>
      </form>
    </main>
  </div>
  <!-- Footer remains unchanged -->
  <footer class="bg-gray-800 p-10 mt-0">
    <!-- ... existing footer content ... -->
  </footer>

  <script>
    // Existing functions
    function goToPreviousPage() { window.location.href = "step1.html"; }
    function validateForm() { /* existing validation */ }

    // New functions for Threat Capacity
    function updateCapacityValue(value) {
      document.getElementById('capacityValue').textContent = value;
    }

    // MISP Threat data and filtering
    const mispThreatsData = [
      { id: 1, title: "CVE-2023-1234: Apache Log4j RCE Vulnerability", severity: "Critical", relevance: "Apache servers" },
      { id: 2, title: "Phishing Campaign: TA505 Activity", severity: "High", relevance: "Email systems" },
      { id: 3, title: "Power Grid Vulnerability", severity: "Medium", relevance: "Infrastructure" },
    ];

    function filterMISPThreats() {
      const severity = document.getElementById('severityFilter').value;
      const relevance = document.getElementById('relevanceFilter').value.toLowerCase();
      const container = document.getElementById('mispThreats');
      
      container.innerHTML = mispThreatsData
        .filter(threat => 
          (!severity || threat.severity === severity) &&
          (!relevance || threat.relevance.toLowerCase().includes(relevance))
        )
        .map(threat => `
          <div class="p-2 mb-2 border-b">
            <h3 class="font-medium">${threat.title}</h3>
            <div class="text-sm text-gray-600">
              Severity: ${threat.severity} | Relevance: ${threat.relevance}
            </div>
          </div>
        `).join('');
    }

    // Initial load of MISP threats
    filterMISPThreats();
  </script>
</body>
</html>